# 通し体験スモークチェック手順書

## 目的
出品登録 → 商品一覧閲覧 → ナビ作成/オンライン問い合わせ → 承認 → 取引化 → 商品が成約済み表示になる一連の体験を、
クリック順と期待結果で固定する。

## 前提・環境
- シード済みの検証環境を利用する（GitHub Actions の migrate/seed 実行後の環境）。
- UI/文言/レイアウトは変更しないため、スクリーンショットは不要。
- **開発用ユーザー切替**は、画面右下の 👥 ボタンで行う。
  - `NEXT_PUBLIC_ENV` が `production` 以外の場合のみ表示される。
  - クリック後、開発用ユーザー一覧（A〜E）から選択する。
  - 選択状態は `localStorage` の `dev_user_type` に保存される。

### 開発ユーザー対応表
- A: `dev_user_1`（株式会社あいおえお）
- B: `dev_user_2`（株式会社かきくけこ）
- C: `dev_user_3`（株式会社さしすせそ）
- D: `dev_user_4`（株式会社たちつてと）
- E: `dev_user_5`（株式会社なにぬねの）

## シナリオA：電話・個別合意ナビ（出品→ナビ作成→承認→SOLD）

1. **開発用ユーザー A（dev_user_1）に切替**
   - 右下の 👥 ボタン → A を選択。
2. `/sell` にアクセスし出品を登録
   - ステータスは **PUBLISHED**。
   - `isNegotiable=false`、`unitPriceExclTax` を入力。
   - `storageLocation` はセレクターで選択。
   - 送信後、出品完了を確認。
3. **開発用ユーザー B（dev_user_2）に切替**
   - 右下の 👥 ボタン → B を選択。
4. `/products` で当該出品を確認
   - 先ほど出品した商品が一覧に表示される。
5. `/products/[listingId]` から「ナビ作成」へ遷移
   - 対象商品の詳細ページで「ナビ作成」をクリック。
6. 売手側で条件入力して送信
   - 送信後、`Navi.status=SENT` が作成される。
7. 買手側（dev_user_2）で取引中一覧を確認
   - 取引中一覧に **承認待ちナビ** が表示される（ステップ0の保証）。
8. 買手側で発送先/担当者を入力し承認
   - 承認後、`Trade` が生成され、`Listing.status=SOLD` になる。
9. `/products` の一覧で「成約済み」を確認
   - 該当出品は **成約済み表示**（グレーアウト）となり、購入導線が無効化されている。

## シナリオB：オンライン問い合わせ（送信→ナビ自動生成→承認/見送り）

1. **開発用ユーザー C（dev_user_3）に切替**
2. `/sell` で **PUBLISHED / 応相談OFF** の出品を登録
   - `isNegotiable=false`、`unitPriceExclTax` を入力。
   - `storageLocation` を指定。
3. **開発用ユーザー D（dev_user_4）に切替**
4. `/products/[listingId]` からオンライン問い合わせ送信
   - 入力後に送信し、送信完了を確認。
5. **開発用ユーザー C（dev_user_3）に切替**
6. 取引中一覧の「オンライン問い合わせ」セクションで確認
   - `Navi.naviType=ONLINE_INQUIRY` かつ `status=SENT` が表示される。
7. 売手が承認
   - `Trade` が生成され、`Listing.status=SOLD` になる。
8. `/products` で成約済み表示を確認

## シナリオC：応相談（オンライン問い合わせ不可）

1. **開発用ユーザー E（dev_user_5）に切替**
2. `/sell` で **isNegotiable=true（単価 null）** の出品を登録
3. `/products` に表示されることを確認
4. `/products/[listingId]` でオンライン問い合わせが不可であることを確認
   - ボタンが非活性または非表示になり、理由が表示される。
