generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

enum TradeNaviStatus {
  DRAFT
  SENT
  APPROVED
  REJECTED
}

enum TradeStatus {
  IN_PROGRESS
  COMPLETED
  CANCELED
}

model User {
  id           String       @id
  companyName  String
  contactName  String?
  address      String?
  tel          String?
  ownedNavis   TradeNavi[]  @relation("OwnerNavis")
  boughtNavis  TradeNavi[]  @relation("BuyerNavis")
  sellingTrade Trade[]      @relation("SellerTrades")
  buyingTrade  Trade[]      @relation("BuyerTrades")
  sentMessages Message[]    @relation("SentMessages")
  receivedMsgs Message[]    @relation("ReceivedMessages")
}

model TradeNavi {
  id           String          @id @default(cuid())
  status       TradeNaviStatus
  ownerUserId  String
  buyerUserId  String?
  payload      Json
  trade        Trade?          @relation("TradeNaviTrade")
  messages     Message[]
  owner        User            @relation("OwnerNavis", fields: [ownerUserId], references: [id])
  buyer        User?           @relation("BuyerNavis", fields: [buyerUserId], references: [id])
}

model Trade {
  id            String       @id @default(cuid())
  sellerUserId  String
  buyerUserId   String
  status        TradeStatus
  payload       Json
  naviId        String?      @unique
  navi          TradeNavi?   @relation("TradeNaviTrade", fields: [naviId], references: [id])
  seller        User         @relation("SellerTrades", fields: [sellerUserId], references: [id])
  buyer         User         @relation("BuyerTrades", fields: [buyerUserId], references: [id])
}

model Message {
  id             String     @id @default(cuid())
  senderUserId   String
  receiverUserId String
  naviId         String
  body           String
  createdAt      DateTime  @default(now())
  sender         User       @relation("SentMessages", fields: [senderUserId], references: [id])
  receiver       User       @relation("ReceivedMessages", fields: [receiverUserId], references: [id])
  navi           TradeNavi  @relation(fields: [naviId], references: [id])
}
